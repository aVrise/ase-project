awk BEGIN{j=1;jj=1} NR==1{for(i=1;i<=NF;i++) a[i]=$i} NR==FNR&&NR>1{if(NR==a[j]+10) {x[j]=$1;y[j]=$2;z[j]=$3;j++}} NR>FNR&&FNR<10{print} NR>FNR&&FNR==7{for(k=1;k<=NF;k++) {if($k<5) {for(kk=1;kk<=k;kk++) b[k]+=$kk}}} NR>FNR&&FNR>9{f=0;for(kk in b){if(b[kk]+9==NR) {print;f=1}} if(f==0){for(k=1;k<=5;k++){if(f!=0){temp=(x[k]-$1)^2+(y[k]-$2)^2+(z[k]-$3)^2; if(temp < 0.01) {print;f=1}}}}if(f==0) print $1,$2,$3,"   F   F   F" } END{print i} ../CONTCAR POSCAR>POSCAR_freq